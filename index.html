<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ENS 통합 페이지</title>
  <style>
    :root{ --bg:#222; --fg:#fff; --card:#333; --muted:#bbb; --brand:#0074e9; --brand-2:#005bb5; }
    *{box-sizing:border-box}
    body { font-family: Arial, sans-serif; margin: 0; background: var(--bg); color: var(--fg); }

    /* 헤더 */
    .header { background: var(--bg); color: var(--fg); padding: 20px; display: flex; align-items: center; gap: 20px; }
    .logo { font-size: 2em; font-weight: bold; color: var(--brand); cursor: pointer; user-select:none }
    .logo:focus{ outline: 2px solid #a8d1ff; border-radius: 6px; }
    .search-box { flex: 1; position: relative; }
    .search-box input { width: 100%; max-width: 680px; padding: 10px 12px; font-size: 1em; border: none; border-radius: 8px; }
    .login-area{margin-left:auto}

    /* 카테고리 */
    .categories { background: var(--bg); padding: 16px 20px; display: flex; gap: 12px; border-bottom: 1px solid #333; justify-content: center; flex-wrap: wrap; }
    .categories button { background: var(--brand); color: #fff; border: none; border-radius: 10px; min-width: 120px; height: 48px; font-size: 1.05em; font-weight: bold; cursor: pointer; transition: background .2s; padding: 0 14px; }
    .categories button:hover { background: var(--brand-2); }
    .categories button.active { outline: 2px solid #a8d1ff; box-shadow: 0 0 0 3px rgba(168,209,255,.2) inset; }

    /* 광고 배너 (전체에서만 보임) */
    .ad-banner-slider { position: relative; width: min(900px, 92vw); margin: 32px auto 0; background: #333; border-bottom: 1px solid #444; min-height: 420px; display: flex; align-items: center; justify-content: center; }
    .ad-banner-slider .ad-arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: #fff; border: none; border-radius: 50%; width: 56px; height: 56px; font-size: 2em; cursor: pointer; z-index: 2; display: flex; align-items: center; justify-content: center; transition: background .2s; }
    .ad-banner-slider .ad-arrow:hover { background: var(--brand); }
    .ad-banner-slider .ad-arrow.left { left: -70px; }
    .ad-banner-slider .ad-arrow.right { right: -70px; }
    .ad-banner { position: relative; width: 100%; height: 400px; overflow: hidden; border-radius: 12px; }
    .ad-banner img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; transform: translateX(0); transition: transform .6s cubic-bezier(.77,0,.18,1); will-change: transform; }
    .ad-banner-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.8em; font-weight: bold; text-shadow: 2px 2px 12px #000; pointer-events: none; z-index: 1; padding: 0 16px; text-align: center; }
    .ad-banner--clickable{cursor:pointer}

    /* 목록 */
    .section-title { font-size: 1.6em; font-weight: bold; color: #fff; margin: 28px 0 10px 20px; }
    .products-scroll { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; padding: 20px; }
    .products-scroll::-webkit-scrollbar { height: 10px; background: #222; }
    .products-scroll::-webkit-scrollbar-thumb { background: #444; border-radius: 6px; }
    .product { background: var(--card); border-radius: 12px; padding: 14px; text-align: center; min-width: 0; max-width: 100%; min-height: 320px; display: flex; flex-direction: column;}
    .product .main-image { width: 100%; height: 200px; object-fit: cover; margin: 0 auto 10px; border-radius: 8px; cursor: pointer; }
    .product-title { font-size: 1.05em; margin: 6px 0; color: #fff; }
    .product-price { color: #9ddcff; font-weight: bold; margin-top: auto; }

    /* 상세보기 (detail.html 스타일) */
    #detailView{ display:none; }
    .title{ font-size:1.4rem; font-weight:800; margin: 18px auto 0; width:min(1100px, 96vw); }
    .container{ width:min(1100px, 96vw); margin: 20px auto; display:grid; grid-template-columns: 1.2fr 1fr; gap: 20px; }
    .card{ background:#2b2b2b; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.4); overflow:hidden }

    .image-side{ padding:16px; display:flex; flex-direction:column; gap:10px; }
    .slider{ position:relative; width:100%; height:460px; overflow:hidden; border-radius:10px; background:#111; }
    .slider-track{ display:flex; height:100%; transition:transform .6s ease; }
    .slider-track img{ flex:0 0 100%; width:100%; height:100%; object-fit:cover; }
    .slider-btn{ position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.5); color:#fff; border:0; border-radius:50%; width:44px; height:44px; cursor:pointer }
    .slider-btn.left{ left:10px } .slider-btn.right{ right:10px }

    .thumbs{ display:flex; gap:8px; flex-wrap:wrap; margin-top:6px; }
    .thumbs img{ width:72px; height:72px; object-fit:cover; border-radius:8px; cursor:pointer; background:#111; border:1px solid #444; }

    .info-side{ padding:16px 18px; display:flex; flex-direction:column; gap:12px; }
    .price{ color:#ff4d4f; font-weight:800; font-size:1.3rem; }
    .badge{ opacity:.9; font-size:1rem; }
    .desc{ opacity:.9; line-height:1.6; white-space: pre-line; }
    .actions{ margin-top:auto; display:flex; gap:10px; }
    .actions button{ flex:1; padding:12px; border-radius:10px; border:0; cursor:pointer; font-weight:700; }
    .actions .primary{ background:var(--brand); color:#fff; }
    .actions .secondary{ background:#3a3a3a; color:#fff; }

    .toolbar{ width:min(1100px, 96vw); margin: 8px auto 0; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .btn{ background:#3a3a3a; color:#fff; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:700 }
    .btn:hover{ background:#4a4a4a }

    .preview{ margin-top:4px; text-align:center; opacity:.85; font-size:.92rem }

    /* 토스트 */
    .toast{position:fixed;bottom:20px;right:20px;background:rgba(17,24,39,.9);color:#fff;padding:12px 14px;border-radius:12px;opacity:0;transform:translateY(8px);transition:.25s;z-index:2000}
    .toast.show{opacity:1;transform:translateY(0)}

    mark { background: #ffea7f; color: #222; padding: 0 .15em; border-radius: 3px; }

    @media (max-width: 980px){
      .container{ grid-template-columns: 1fr; }
      .slider{ height:300px; }
    }
  </style>
</head>
<body>
  <!-- 헤더 -->
  <div class="header">
    <div class="logo" id="logoHome" role="button" tabindex="0" aria-label="홈으로 이동">ENS</div>
    <div class="search-box">
      <input id="searchInput" type="text" placeholder="선수 이름, 팀, 포지션으로 검색" aria-label="검색" />
    </div>
    <div class="login-area" id="loginArea"></div>
  </div>

  <!-- 카테고리 -->
  <div class="categories" id="categoryBar">
    <button type="button" data-target="전체" class="active" aria-current="page">전체</button>
    <button type="button" data-target="NBA">NBA</button>
    <button type="button" data-target="축구">축구</button>
    <button type="button" data-target="E-스포츠">e-스포츠</button>
    <button type="button" data-target="쇼핑">쇼핑</button>
    <button type="button" data-target="뉴스">뉴스</button>
    <button type="button" data-target="커뮤니티">커뮤니티</button>
  </div>

  <!-- 광고 배너 -->
  <div class="ad-banner-slider" id="bannerSection" aria-label="프로모션 배너">
    <button type="button" class="ad-arrow left" aria-label="이전 배너">‹</button>
    <div class="ad-banner ad-banner--clickable" id="adBanner" role="button" tabindex="0" aria-label="배너 클릭 시 쇼핑으로 이동">
      <img src="https://images.unsplash.com/photo-1604726923839-606d2f0e0870?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="농구용품 최대 50% 할인!" />
      <div class="ad-banner-text" id="adBannerText">농구의 열정! 지금 쇼핑하세요</div>
    </div>
    <button type="button" class="ad-arrow right" aria-label="다음 배너">›</button>
  </div>

  <!-- 목록 -->
  <div id="content"></div>

  <!-- 상세 (detail.html 스타일) -->
  <div id="detailView" aria-live="polite">
    <div class="toolbar">
      <button id="backBtn" class="btn" type="button">← 목록으로</button>
      <div class="muted" style="opacity:.8">상세 페이지</div>
    </div>

    <h2 class="title" id="dtTitle">상세</h2>

    <div class="container">
      <!-- 왼쪽: 이미지 -->
      <div class="card image-side">
        <div class="slider" id="dtSlider">
          <div class="slider-track" id="sliderTrack"></div>
          <button class="slider-btn left" id="prevBtn" type="button" aria-label="이전 이미지">‹</button>
          <button class="slider-btn right" id="nextBtn" type="button" aria-label="다음 이미지">›</button>
        </div>
        <div id="dtThumbs" class="thumbs"></div>
        <div id="dtPreview" class="preview"></div>
      </div>

      <!-- 오른쪽: 정보 -->
      <div class="card info-side">
        <div id="dtPrice" class="price" style="display:none"></div>
        <div id="dtBadge" class="badge"></div>
        <div id="dtDesc" class="desc"></div>
        <div id="dtActions" class="actions" style="display:none">
          <button class="secondary" type="button">장바구니</button>
          <button class="primary" type="button">바로구매</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 토스트 -->
  <div id="msg" class="toast" role="status" aria-live="polite"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /* ===== 토스트 ===== */
      function showToast(text){
        const t=document.getElementById('msg');
        t.textContent=text;
        t.classList.add('show');
        setTimeout(()=> t.classList.remove('show'), 2000);
      }

      /* ===== 세션/유저 ===== */
      const USERS_KEY='demo_users', SESSION_KEY='demo_session';
      const getSession=()=>{ try { return JSON.parse(localStorage.getItem(SESSION_KEY)); } catch { return null; } };
      const loadUsers=()=>{ try { return JSON.parse(localStorage.getItem(USERS_KEY)) || []; } catch { return []; } };
      function renderLoginArea(){
        const area=document.getElementById('loginArea');
        const s=getSession();
        if(!s){
          area.innerHTML = `
            <button id="goLogin" type="button"
              style="background:#0074e9;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-weight:700;cursor:pointer">
              로그인
            </button>
            <a href="signup.html" style="margin-left:8px;color:#9ec2ff;text-decoration:none;font-weight:700">회원가입</a>`;
          document.getElementById('goLogin')?.addEventListener('click', () => { location.href = 'login.html'; });
        } else {
          const users=loadUsers();
          const me=users.find(u => u.username===s.id || u.email===s.id);
          const display = me ? me.username : s.id;
          area.innerHTML = `
            <span style="margin-right:10px">👋 <b>${display}</b> 님</span>
            <button id="logoutBtn" type="button"
              style="background:#444;color:#fff;border:none;border-radius:6px;padding:8px 12px;font-weight:700;cursor:pointer">
              로그아웃
            </button>`;
          document.getElementById('logoutBtn')?.addEventListener('click', () => {
            localStorage.removeItem(SESSION_KEY);
            showToast('로그아웃 되었습니다');
            renderLoginArea();
            goHome();
          });
        }
      }

      /* ===== 유틸 ===== */
      const escReg = (s) => (s||'').replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      function highlight(text, q) {
        if (!q) return text;
        const re = new RegExp(escReg(q), 'gi');
        return text.replace(re, (m) => `<mark>${m}</mark>`);
      }
      const norm = (s) => (s ?? '').toString().toLowerCase();

      /* ===== 데이터 ===== */
      const players = [
        { name:"르브론 제임스", sport:"NBA", team:"LA 레이커스", position:"SF/PF", number:23, height:"206cm", weight:"113kg",
          main:"https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=600&q=80",
          thumbnails:["https://images.unsplash.com/photo-1606813902787-53e9497f7f26?auto=format&fit=crop&w=300&q=80","https://images.unsplash.com/photo-1518544881151-1ffb1453f4ec?auto=format&fit=crop&w=300&q=80"],
          bio:"\nNBA 역대급 포워드. 다재다능한 플레이메이킹과 리더십." },
        { name:"스테판 커리", sport:"NBA", team:"골든스테이트 워리어스", position:"PG", number:30, height:"188cm", weight:"84kg",
          main:"https://images.unsplash.com/photo-1521412644187-c49fa049e84d?auto=format&fit=crop&w=600&q=80",
          thumbnails:["https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=300&q=80","https://images.unsplash.com/photo-1550332781-aecd27c8a1a6?auto=format&fit=crop&w=300&q=80"],
          bio:"\n3점 슈팅의 혁신. 스페이싱과 오프볼 무브의 교과서." },
        { name:"리오넬 메시", sport:"축구", team:"인터 마이애미", position:"FW", number:10, height:"170cm", weight:"72kg",
          main:"https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?auto=format&fit=crop&w=600&q=80",
          thumbnails:["https://images.unsplash.com/photo-1543326727-cf6c39e8f84c?auto=format&fit=crop&w=300&q=80"],
          bio:"\n드리블·시야·결정력 모두 최상급의 레전드 공격수." },
        { name:"손흥민", sport:"축구", team:"토트넘 홋스퍼", position:"FW", number:7, height:"183cm", weight:"78kg",
          main:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=600&q=80",
          thumbnails:[],
          bio:"\n양발 슈팅과 침투가 강점인 프리미어리그 스타." },
        { name:"페이커", sport:"E-스포츠", team:"T1", position:"MID", number:null, height:"177cm", weight:"56kg",
          main:"https://live.staticflickr.com/65535/52463757476_6affa467aa_b.jpg",
          thumbnails:["https://live.staticflickr.com/65535/52462683597_f175c3d3ac_b.jpg","https://live.staticflickr.com/65535/52463191906_1a55a52fbb_b.jpg","https://live.staticflickr.com/65535/52086086463_cc94c3f821_b.jpg","https://live.staticflickr.com/65535/54111496707_aa59c5d44f_b.jpg"],
          bio:"\n본명: 이상혁 \n\n 국적: 대한민국 \n\n 생년월일: 1996년 5월 7일\n\n 경력 상금: $1,922,084.56 USD (￦2,674,484,561 KRW)\n\n LCK의 T1 소속 주장이자 미드 라이너 및 파트 오너.\n\n 대회 경력:\n Worlds 우승 5회, MSI 우승 2회, LCK 우승 10회, EWC 우승 1회, IEM 우승 1회, 리프트 라이벌즈 우승 1회, 리그 오브 레전드 올스타전 우승 5회, 리그 오브 레전드 시즌 킥오프 우승 1회, NLB 우승 1회, 아시안 게임 금메달, Worlds MVP 2회, MSI MVP 1회, LCK 통합 MVP 2회, LCK 포스트시즌 MVP 1회, EWC MVP 1회, LCK All-Pro First team 2회" },
        { name:"룰러", sport:"E-스포츠", team:"GEN.G", position:"BOT", number:null, height:"181cm", weight:"86kg",
          main:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=600&q=80",
          thumbnails:[],
          bio:"\n본명: 박재혁 \n\n 국적: 대한민국 \n\n 생년월일: 1996년 5월 7일\n\n 경력 상금: $1,922,084.56 USD (￦2,674,484,561 KRW)\n\n LCK의 Gen.G 소속 주장이자 바텀 라이너. Gen.G LoL의 첫 번째 영구 결번 선수이다" },
        { name:"피넛", sport:"E-스포츠", team:"Hanwha Life Esports", position:"JGL", number:null, height:"170cm", weight:"53kg",
          main:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=600&q=80",
          thumbnails:[],
          bio:"\n본명: 한왕호 \n\n 국적: 대한민국 \n\n 생년월일: 1996년 5월 7일\n\n 경력 상금: $1,922,084.56 USD (￦2,674,484,561 KRW)\n\n LCK의 한화생명e스포츠 소속 주장이자 정글러." }, 
        { name:"더샤이", sport:"E-스포츠", team:"Invictus Gaming", position:"TOP", number:null, height:"178cm", weight:"55kg",
          main:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=600&q=80",
          thumbnails:[],
          bio:"\n본명: 강승록 \n\n 국적: 대한민국 \n\n 생년월일: 1996년 5월 7일\n\n 경력 상금: $1,922,084.56 USD (￦2,674,484,561 KRW)\n\n LPL의 Invictus Gaming 소속 탑 라이너." },
        { name:"케리아", sport:"E-스포츠", team:"T1", position:"SPT", number:null, height:"165cm", weight:null,
          main:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=600&q=80",
          thumbnails:[],
          bio:"\n본명: 류민석 \n\n 국적: 대한민국 \n\n 생년월일: 1996년 5월 7일\n\n 경력 상금: $1,922,084.56 USD (￦2,674,484,561 KRW)\n\n LCK의 T1 소속 서포터." },
      ];

      const products = {
        "쇼핑": [
          { title:"르브론 제임스 굿즈", price:"₩120,000",
            main:"https://images.unsplash.com/photo-1517649763962-0c623066013b?auto=format&fit=crop&w=600&q=80",
            thumbnails:["https://images.unsplash.com/photo-1606813902787-53e9497f7f26?auto=format&fit=crop&w=300&q=80","https://images.unsplash.com/photo-1518544881151-1ffb1453f4ec?auto=format&fit=crop&w=300&q=80"],
            desc:"르브론 제임스 한정판 굿즈." },
          { title:"스테판 커리 굿즈", price:"₩95,000",
            main:"https://images.unsplash.com/photo-1521412644187-c49fa049e84d?auto=format&fit=crop&w=600&q=80",
            thumbnails:["https://images.unsplash.com/photo-1546519638-68e109498ffc?auto=format&fit=crop&w=300&q=80","https://images.unsplash.com/photo-1550332781-aecd27c8a1a6?auto=format&fit=crop&w=300&q=80"],
            desc:"커리 시그니처 에디션." },
          { title:"리오넬 메시 굿즈", price:"₩150,000",
            main:"https://images.unsplash.com/photo-1517927033932-b3d18e61fb3a?auto=format&fit=crop&w=600&q=80",
            thumbnails:["https://images.unsplash.com/photo-1543326727-cf6c39e8f84c?auto=format&fit=crop&w=300&q=80"],
            desc:"메시 월드투어 기념 머천다이즈." },
          { title:"손흥민 굿즈", price:"₩130,000",
            main:"https://images.unsplash.com/photo-1508780709619-79562169bc64?auto=format&fit=crop&w=600&q=80",
            thumbnails:[], desc:"손흥민 선수 오피셜 굿즈." },
          { title:"페이커 굿즈", price:"₩110,000",
            main:"https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=600&q=80",
            thumbnails:["https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=300&q=80"],
            desc:"페이커 한정판 게이밍 기어." }
        ]
      };

      /* ===== 배너 ===== */
      const bannerData = [
        { src: "https://images.unsplash.com/photo-1604726923839-606d2f0e0870?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", text:"농구용품 최대 50% 할인!" },
        { src: "https://images.unsplash.com/photo-1511886929837-354d827aae26?q=80&w=764&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", text:"축구 용품 특가! 놓치지 마세요" },
        { src: "https://images.unsplash.com/photo-1544652478-6653e09f18a2?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", text:"E-스포츠 게이밍 기어 할인" }
      ];
      let currentBanner=0, bannerTimer=null;
      const bannerSection = document.getElementById('bannerSection');
      const adBannerDiv = document.getElementById('adBanner');
      const adBannerText = document.getElementById('adBannerText');
      function slideTo(next, direction = 1){
        const oldImg = adBannerDiv.querySelector('img');
        const newImg = document.createElement('img');
        newImg.src = bannerData[next].src;
        newImg.alt = bannerData[next].text;
        newImg.style.transform = `translateX(${direction>0? '100%':'-100%'})`;
        adBannerDiv.appendChild(newImg);
        adBannerText.textContent = bannerData[next].text;
        requestAnimationFrame(()=>{
          newImg.style.transform = 'translateX(0)';
          if(oldImg){ oldImg.style.transform = `translateX(${direction>0? '-100%':'100%'})`; }
        });
        setTimeout(()=>{ if(oldImg && adBannerDiv.contains(oldImg)) oldImg.remove(); }, 650);
      }
      function moveBanner(dir){
        const next = (currentBanner + dir + bannerData.length) % bannerData.length;
        slideTo(next, dir);
        currentBanner = next;
        resetBannerTimer();
      }
      function resetBannerTimer(){
        if(bannerTimer) clearInterval(bannerTimer);
        bannerTimer = setInterval(()=> moveBanner(1), 6000);
      }
      document.querySelector('.ad-arrow.left').addEventListener('click', ()=> moveBanner(-1));
      document.querySelector('.ad-arrow.right').addEventListener('click', ()=> moveBanner(1));
      resetBannerTimer();

      // 배너 클릭/키보드 → 쇼핑으로 이동
      function goShopFromBanner(){
        const shopBtn = document.querySelector('#categoryBar [data-target="쇼핑"]');
        if (shopBtn) {
          shopBtn.click();
          const catTop = document.querySelector('.categories')?.offsetTop ?? 0;
          window.scrollTo({ top: catTop, behavior: 'smooth' });
        }
      }
      adBannerDiv.addEventListener('click', goShopFromBanner);
      adBannerDiv.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); goShopFromBanner(); }});

      /* ===== 목록 렌더 ===== */
      const content = document.getElementById('content');
      let currentCategory = '전체';

      function makePlayerCard(p, q=''){
        const card = document.createElement('div');
        card.className = 'product';
        card.innerHTML = `
          <img class="main-image" src="${p.main}" alt="${p.name}">
          <div class="product-title">${highlight(p.name, q)}</div>
          <div class="product-price">${[p.team||'', p.position?('· '+p.position):''].join(' ').trim()}</div>
        `;
        card.querySelector('.main-image').addEventListener('click', ()=> gotoDetail({mode:'player', data:p}));
        return card;
      }
      function makeProductCard(item){
        const card = document.createElement('div');
        card.className = 'product';
        card.innerHTML = `
          <img class="main-image" src="${item.main}" alt="${item.title}">
          <div class="product-title">${item.title}</div>
          <div class="product-price" style="color:#ff4d4f">${item.price ?? ''}</div>
        `;
        card.querySelector('.main-image').addEventListener('click', ()=> gotoDetail({mode:'product', data:item}));
        return card;
      }

      function renderPlayers(list, title, q=''){
        content.innerHTML = '';
        const t = document.createElement('div');
        t.className = 'section-title';
        t.textContent = title;
        const sc = document.createElement('div');
        sc.className = 'products-scroll';
        if(list.length === 0) sc.innerHTML = `<div style="padding:0 20px 24px; opacity:.9">일치하는 선수가 없습니다.</div>`;
        else list.forEach(p => sc.appendChild(makePlayerCard(p, q)));
        content.appendChild(t);
        content.appendChild(sc);
      }
      function renderShopping(list){
        content.innerHTML = '';
        const t = document.createElement('div');
        t.className = 'section-title';
        t.textContent = '쇼핑';
        const sc = document.createElement('div');
        sc.className = 'products-scroll';
        if(list.length === 0) sc.innerHTML = `<div style="padding:0 20px 24px; opacity:.9">등록된 상품이 없습니다.</div>`;
        else list.forEach(it => sc.appendChild(makeProductCard(it)));
        content.appendChild(t);
        content.appendChild(sc);
      }

      function renderByCategory(cat, q=''){
        currentCategory = cat;
        const qn = norm(q);

        // active & aria-current
        document.querySelectorAll('#categoryBar button').forEach(b=>{ b.classList.remove('active'); b.removeAttribute('aria-current'); });
        const activeBtn = document.querySelector(`#categoryBar [data-target="${cat}"]`);
        activeBtn?.classList.add('active'); activeBtn?.setAttribute('aria-current','page');

        // 전환
        content.style.display = 'block';
        detail.style.display = 'none';

        if (cat === '전체') {
          bannerSection.style.display = 'flex';
          const list = players.filter(p => [p.name,p.team,p.position].some(f => norm(f).includes(qn)));
          renderPlayers(list, q ? `선수 소개 (검색 결과 ${list.length}명)` : '선수 소개', q);
          return;
        }
        if (cat === 'NBA' || cat === '축구' || cat === 'E-스포츠') {
          bannerSection.style.display = 'none';
          const list = players.filter(p => p.sport === cat && [p.name,p.team,p.position].some(f => norm(f).includes(qn)));
          renderPlayers(list, q ? `${cat} (검색 결과 ${list.length}명)` : cat, q);
          return;
        }
        if (cat === '쇼핑') {
          bannerSection.style.display = 'none';
          const base = products['쇼핑'] || [];
          const list = base.filter(it => (it.title||'').toLowerCase().includes(qn));
          renderShopping(list);
          return;
        }
        bannerSection.style.display = 'none';
        content.innerHTML = `<div class="section-title">${cat}</div><div style="padding:0 20px 24px; opacity:.9">준비 중입니다.</div>`;
      }

      /* ===== 상세 (detail.html UX) ===== */
      const detail = document.getElementById('detailView');
      const dtTitle  = document.getElementById('dtTitle');
      const sliderTrack = document.getElementById('sliderTrack');
      const dtThumbs = document.getElementById('dtThumbs');
      const dtPreview= document.getElementById('dtPreview');
      const dtPrice = document.getElementById('dtPrice');
      const dtBadge = document.getElementById('dtBadge');
      const dtDesc  = document.getElementById('dtDesc');
      const dtActions = document.getElementById('dtActions');

      let imgIdx=0, allImgs=[], slideTimer=null;

      function highlightThumb(i){
        [...dtThumbs.children].forEach((el,idx)=>{
          el.style.outline = (idx===i) ? '2px solid #0074e9' : '';
        });
      }
      function showSlide(n){
        imgIdx = (n + allImgs.length) % allImgs.length;
        sliderTrack.style.transform = `translateX(-${imgIdx*100}%)`;
        highlightThumb(imgIdx);
        dtPreview.textContent = `(${imgIdx+1}/${allImgs.length}) ${dtTitle.textContent}`;
      }
      function next(){ showSlide(imgIdx+1); }
      function prev(){ showSlide(imgIdx-1); }
      function startAuto(){ stopAuto(); slideTimer = setInterval(next, 3000); }
      function stopAuto(){ if(slideTimer) clearInterval(slideTimer); }

      document.getElementById('prevBtn').onclick = ()=>{ prev(); startAuto(); };
      document.getElementById('nextBtn').onclick = ()=>{ next(); startAuto(); };
      document.getElementById('dtSlider').addEventListener('mouseenter', stopAuto);
      document.getElementById('dtSlider').addEventListener('mouseleave', startAuto);

      function gotoDetail(payload){
        const { mode, data: obj } = payload;

        // 전환
        content.style.display = 'none';
        bannerSection.style.display = 'none';
        detail.style.display = 'block';

        // 정보/가격/버튼
        dtTitle.textContent = (mode === 'player') ? obj.name : (obj.title || '상세');
        dtDesc.textContent  = (mode === 'player') ? (obj.bio || '') : (obj.desc || '');
        dtBadge.textContent = (mode === 'player')
          ? [obj.team, obj.position, (obj.number?('#'+obj.number):''), obj.height, obj.weight].filter(Boolean).join(' · ')
          : '';
        if(mode === 'product'){
          dtPrice.style.display='block'; dtPrice.textContent = obj.price || '';
          dtActions.style.display = 'flex';
        }else{
          dtPrice.style.display='none'; dtPrice.textContent = '';
          dtActions.style.display = 'none';
        }

        // 이미지(메인 + 썸네일)
        allImgs = [obj.main, ...(obj.thumbnails || [])];
        sliderTrack.innerHTML = allImgs.map((src,i)=>`<img src="${src}" alt="${dtTitle.textContent} ${i+1}">`).join('');
        dtThumbs.innerHTML = '';
        allImgs.forEach((src,i)=>{
          const t = document.createElement('img');
          t.src = src; t.alt = `썸네일 ${i+1}`;
          t.addEventListener('click', ()=>{ showSlide(i); startAuto(); });
          dtThumbs.appendChild(t);
        });

        showSlide(0);
        startAuto();
      }

      document.getElementById('backBtn').addEventListener('click', ()=>{
        detail.style.display = 'none';
        content.style.display = 'block';
        if(currentCategory==='전체') bannerSection.style.display='flex';
        stopAuto();
      });

      function stopAuto(){ if(slideTimer) clearInterval(slideTimer); }

      /* ===== 카테고리/검색/로고 ===== */
      document.getElementById('categoryBar').addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-target]');
        if(!btn) return;
        renderByCategory(btn.dataset.target);
      });

      const searchInput = document.getElementById('searchInput');
      function runSearch(){
        const q = searchInput.value.trim();
        // 상세 상태에서 검색 → 목록 모드
        detail.style.display = 'none';
        content.style.display = 'block';
        if(currentCategory==='전체') bannerSection.style.display='flex'; else bannerSection.style.display='none';
        stopAuto();
        renderByCategory(currentCategory, q);
      }
      searchInput.addEventListener('input', runSearch);
      searchInput.addEventListener('keydown', (e)=>{
        if(e.key==='Escape'){ searchInput.value=''; runSearch(); }
        else if(e.key==='Enter'){ runSearch(); }
      });

      function goHome(){
        renderByCategory('전체');
        detail.style.display='none';
        content.style.display='block';
        bannerSection.style.display='flex';
        stopAuto();
      }
      document.getElementById('logoHome').addEventListener('click', goHome);
      document.getElementById('logoHome').addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); goHome(); }});

      /* 초기 렌더 */
      renderLoginArea();
      renderByCategory('전체');
    });
  </script>
</body>
</html>
