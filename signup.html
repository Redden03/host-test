<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>íšŒì›ê°€ì…</title>
  <style>
    :root{
      --bg:#222;--muted:#94a3b8;--text:#e5e7eb;
      --brand:#0074e9;--brand-700:#005bb5;
      --ok:#22c55e;--danger:#ef4444;--shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial,sans-serif;
      min-height:100vh;display:flex;flex-direction:column
    }

    /* í—¤ë” */
    .header{background:var(--bg);color:var(--text);padding:20px;display:flex;align-items:center;gap:20px}
    .logo{
      font-family: Arial, sans-serif; /* ë©”ì¸ê³¼ ë™ì¼ */
      font-size: 2em;
      font-weight: bold;
      color: var(--brand);
      cursor: pointer;
      user-select:none;
      line-height:1
    }
    .logo:focus{outline:2px solid #a8d1ff;border-radius:6px}
    .login-area{margin-left:auto}

    /* ì¹´ë“œ */
    .main{flex:1;display:grid;place-items:center;padding:24px}
    .card{
      width:min(620px,92vw);
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:28px
    }
    h1{margin:0 0 8px;font-size:28px}
    form{display:grid;gap:12px}
    label{font-size:13px;color:var(--muted)}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .field{position:relative}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(2,6,23,.65);color:var(--text);outline:none}
    input:focus{border-color:rgba(59,130,246,.7);box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:var(--muted);cursor:pointer}
    .btn{padding:12px 14px;border-radius:12px;border:none;background:var(--brand);color:white;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--brand-700)}
    .hint{font-size:12px;color:var(--muted)}
    .meter{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .meter>div{height:100%;width:0;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);transition:width .25s}
    .agree{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:14px}
    a{color:#9ec2ff;text-decoration:none}
    .toast{position:fixed;bottom:20px;right:20px;background:rgba(17,24,39,.9);color:#fff;padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transform:translateY(8px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <div class="header">
    <div class="logo" id="logoHome" role="button" tabindex="0" aria-label="í™ˆìœ¼ë¡œ ì´ë™">ENS</div>
    <div class="login-area" id="loginArea"></div>
  </div>

  <div class="main">
    <div class="card">
      <h1>íšŒì›ê°€ì…</h1>
      <form id="signupForm">
        <div class="row">
          <div>
            <label for="suId">ì•„ì´ë””</label>
            <input id="suId" minlength="3" maxlength="20" placeholder="ì˜ë¬¸/ìˆ«ì/ì–¸ë”ìŠ¤ì½”ì–´ 3~20ì" required />
          </div>
          <div>
            <label for="suEmail">ì´ë©”ì¼</label>
            <input id="suEmail" type="email" placeholder="example@domain.com" required />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="suPw">ë¹„ë°€ë²ˆí˜¸</label>
            <input id="suPw" type="password" minlength="8" placeholder="8ì ì´ìƒ (ë¬¸ìÂ·ìˆ«ì ì¡°í•© ê¶Œì¥)" required />
            <button class="toggle" type="button" data-target="#suPw">í‘œì‹œ</button>
            <div class="meter" aria-hidden="true"><div id="pwBar"></div></div>
            <div class="hint">ê°•ë„: <b id="pwLabel">ì•½í•¨</b> Â· <span id="pwTips">8ì ì´ìƒ</span></div>
          </div>
          <div class="field">
            <label for="suPw2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input id="suPw2" type="password" placeholder="ë‹¤ì‹œ ì…ë ¥" required />
            <button class="toggle" type="button" data-target="#suPw2">í‘œì‹œ</button>
          </div>
        </div>

        <label class="agree"><input type="checkbox" id="agree" /> ì´ìš© ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤</label>
        <button class="btn" type="submit">íšŒì›ê°€ì…</button>
        <div class="hint">ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? <a href="login.html">ë¡œê·¸ì¸ìœ¼ë¡œ ì´ë™</a></div>
      </form>
    </div>
  </div>

  <div id="msg" class="toast" role="status" aria-live="polite"></div>

  <script>
    const USERS_KEY='demo_users', SESSION_KEY='demo_session';
    const $=s=>document.querySelector(s);
    const showToast=t=>{const m=$('#msg');m.textContent=t;m.classList.add('show');setTimeout(()=>m.classList.remove('show'),2000)};
    const loadUsers=()=>{try{return JSON.parse(localStorage.getItem(USERS_KEY))||[]}catch{return[]}};
    const saveUsers=a=>localStorage.setItem(USERS_KEY,JSON.stringify(a));
    const getSession=()=>{try{return JSON.parse(localStorage.getItem(SESSION_KEY))}catch{return null}};

    // í—¤ë” login-area ë Œë” (ë©”ì¸ê³¼ ë™ì¼ ë™ì‘)
    function renderLoginArea(){
      const area = document.getElementById('loginArea');
      const s = getSession();
      if(!area) return;

      if(!s){
        area.innerHTML = `
          <button id="goLogin" type="button"
            style="background:#0074e9;color:#fff;border:none;border-radius:6px;padding:10px 18px;font-weight:700;cursor:pointer">
            ë¡œê·¸ì¸
          </button>
          <a href="signup.html" style="margin-left:8px;color:#9ec2ff;text-decoration:none;font-weight:700">íšŒì›ê°€ì…</a>
        `;
        document.getElementById('goLogin')?.addEventListener('click', () => {
          sessionStorage.setItem('returnTo', location.href);
          location.href = 'login.html';
        });
      } else {
        const users = loadUsers();
        const me = users.find(u => u.username === s.id || u.email === s.id);
        const display = me ? me.username : s.id;
        area.innerHTML = `
          <span style="margin-right:10px">ğŸ‘‹ <b>${display}</b> ë‹˜</span>
          <button id="logoutBtn" type="button"
            style="background:#444;color:#fff;border:none;border-radius:6px;padding:10px 12px;font-weight:700;cursor:pointer">
            ë¡œê·¸ì•„ì›ƒ
          </button>
        `;
        document.getElementById('logoutBtn')?.addEventListener('click', () => {
          localStorage.removeItem(SESSION_KEY);
          showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤');
          renderLoginArea();
          location.href = 'index.html#ì „ì²´';
        });
      }
    }

    // í‘œì‹œ/ìˆ¨ê¹€
    function toggleEye(btn){
      const target=document.querySelector(btn.dataset.target);
      if(!target) return;
      target.type = target.type==='password' ? 'text' : 'password';
      btn.textContent = target.type==='password' ? 'í‘œì‹œ' : 'ìˆ¨ê¹€';
    }
    document.querySelectorAll('.toggle').forEach(b=>b.addEventListener('click',()=>toggleEye(b)));

    // ë¹„ë°€ë²ˆí˜¸ ê°•ë„
    const enc=new TextEncoder();
    const toHex=b=>Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join('');
    async function hashPw(pw,saltHex){
      const salt=saltHex?Uint8Array.from(saltHex.match(/.{1,2}/g).map(h=>parseInt(h,16))):crypto.getRandomValues(new Uint8Array(16));
      const combined=new Uint8Array(salt.length+enc.encode(pw).length);
      combined.set(salt,0); combined.set(enc.encode(pw),salt.length);
      const digest=await crypto.subtle.digest('SHA-256',combined);
      return { saltHex: toHex(salt), hashHex: toHex(digest) };
    }
    function scorePassword(p){let s=0;const tests=[/.{8,}/,/[a-z]/,/[A-Z]/,/\d/,/[^A-Za-z0-9\s]/];tests.forEach(re=>{if(re.test(p))s++});if(p.length>=12)s++;return Math.min(s,6)}
    function updatePwMeter(){
      const p=$('#suPw').value, s=scorePassword(p);
      const pct=[0,20,40,60,75,90,100][s]; $('#pwBar').style.width=pct+'%';
      const labels=['ì—†ìŒ','ë§¤ìš° ì•½í•¨','ì•½í•¨','ë³´í†µ','ì¢‹ìŒ','ê°•í•¨','ì•„ì£¼ ê°•í•¨']; $('#pwLabel').textContent=labels[s]||'ì•½í•¨';
      const req=[]; if(p.length<8)req.push('8ì ì´ìƒ'); if(!/[a-z]/.test(p))req.push('ì†Œë¬¸ì'); if(!/[A-Z]/.test(p))req.push('ëŒ€ë¬¸ì'); if(!/\d/.test(p))req.push('ìˆ«ì'); if(!/[^A-Za-z0-9\s]/.test(p))req.push('íŠ¹ìˆ˜ë¬¸ì');
      $('#pwTips').textContent=req.length?req.join(', '):'ì¢‹ì•„ìš”!';
    }
    $('#suPw').addEventListener('input',updatePwMeter);

    // ì œì¶œ
    $('#signupForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const username=$('#suId').value.trim();
      const email=$('#suEmail').value.trim();
      const pw=$('#suPw').value;
      const pw2=$('#suPw2').value;
      const agree=$('#agree').checked;

      if(!agree){showToast('ì•½ê´€ì— ë™ì˜í•´ì•¼ ê°€ì…í•  ìˆ˜ ìˆì–´ìš”');return}
      if(pw!==pw2){showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');return}
      if(!/^[a-zA-Z0-9_]{3,20}$/.test(username)){showToast('ì•„ì´ë”” í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');return}

      const users=loadUsers();
      const dup=users.some(u=>u.username.toLowerCase()===username.toLowerCase() || u.email.toLowerCase()===email.toLowerCase());
      if(dup){showToast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””/ì´ë©”ì¼');return}

      const {saltHex,hashHex}=await hashPw(pw);
      users.push({username,email,saltHex,hashHex,createdAt:new Date().toISOString()});
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
      showToast('íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
      setTimeout(()=>{ location.href='login.html'; }, 600);
    });

    // ë¡œê³  â†’ í•­ìƒ í™ˆ(ì „ì²´)
    const logoHome=document.getElementById('logoHome');
    logoHome.addEventListener('click',()=>{location.href='index.html#ì „ì²´'});
    logoHome.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();location.href='index.html#ì „ì²´';}});

    // ì´ˆê¸° ë Œë”
    renderLoginArea();
  </script>
</body>
</html>
