<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>회원가입</title>
  <style>
    :root{
      --bg:#222;--muted:#94a3b8;--text:#e5e7eb;
      --brand:#0074e9;--brand-700:#005bb5;
      --ok:#22c55e;--danger:#ef4444;--shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Arial,sans-serif;
      min-height:100vh;display:flex;flex-direction:column
    }

    /* 헤더 */
    .header{background:var(--bg);color:var(--text);padding:20px;display:flex;align-items:center;gap:20px}
    .logo{
      font-family: Arial, sans-serif; /* 메인과 동일 */
      font-size: 2em;
      font-weight: bold;
      color: var(--brand);
      cursor: pointer;
      user-select:none;
      line-height:1
    }
    .logo:focus{outline:2px solid #a8d1ff;border-radius:6px}
    .login-area{margin-left:auto}

    /* 카드 */
    .main{flex:1;display:grid;place-items:center;padding:24px}
    .card{
      width:min(620px,92vw);
      background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:28px
    }
    h1{margin:0 0 8px;font-size:28px}
    form{display:grid;gap:12px}
    label{font-size:13px;color:var(--muted)}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .field{position:relative}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(2,6,23,.65);color:var(--text);outline:none}
    input:focus{border-color:rgba(59,130,246,.7);box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:var(--muted);cursor:pointer}
    .btn{padding:12px 14px;border-radius:12px;border:none;background:var(--brand);color:white;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--brand-700)}
    .hint{font-size:12px;color:var(--muted)}
    .meter{height:8px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .meter>div{height:100%;width:0;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);transition:width .25s}
    .agree{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:14px}
    a{color:#9ec2ff;text-decoration:none}
    .toast{position:fixed;bottom:20px;right:20px;background:rgba(17,24,39,.9);color:#fff;padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transform:translateY(8px);transition:.25s}
    .toast.show{opacity:1;transform:translateY(0)}
  </style>
</head>
<body>
  <div class="header">
    <div class="logo" id="logoHome" role="button" tabindex="0" aria-label="홈으로 이동">ENS</div>
    <div class="login-area" id="loginArea"></div>
  </div>

  <div class="main">
    <div class="card">
      <h1>회원가입</h1>
      <form id="signupForm">
        <div class="row">
          <div>
            <label for="suId">아이디</label>
            <input id="suId" minlength="3" maxlength="20" placeholder="영문/숫자/언더스코어 3~20자" required />
          </div>
          <div>
            <label for="suEmail">이메일</label>
            <input id="suEmail" type="email" placeholder="example@domain.com" required />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="suPw">비밀번호</label>
            <input id="suPw" type="password" minlength="8" placeholder="8자 이상 (문자·숫자 조합 권장)" required />
            <button class="toggle" type="button" data-target="#suPw">표시</button>
            <div class="meter" aria-hidden="true"><div id="pwBar"></div></div>
            <div class="hint">강도: <b id="pwLabel">약함</b> · <span id="pwTips">8자 이상</span></div>
          </div>
          <div class="field">
            <label for="suPw2">비밀번호 확인</label>
            <input id="suPw2" type="password" placeholder="다시 입력" required />
            <button class="toggle" type="button" data-target="#suPw2">표시</button>
          </div>
        </div>

        <label class="agree"><input type="checkbox" id="agree" /> 이용 약관에 동의합니다</label>
        <button class="btn" type="submit">회원가입</button>
        <div class="hint">이미 계정이 있나요? <a href="login.html">로그인으로 이동</a></div>
      </form>
    </div>
  </div>

  <div id="msg" class="toast" role="status" aria-live="polite"></div>

  <script>
    const USERS_KEY='demo_users', SESSION_KEY='demo_session';
    const $=s=>document.querySelector(s);
    const showToast=t=>{const m=$('#msg');m.textContent=t;m.classList.add('show');setTimeout(()=>m.classList.remove('show'),2000)};
    const loadUsers=()=>{try{return JSON.parse(localStorage.getItem(USERS_KEY))||[]}catch{return[]}};
    const saveUsers=a=>localStorage.setItem(USERS_KEY,JSON.stringify(a));
    const getSession=()=>{try{return JSON.parse(localStorage.getItem(SESSION_KEY))}catch{return null}};

    // 헤더 login-area 렌더 (메인과 동일 동작)
    function renderLoginArea(){
      const area = document.getElementById('loginArea');
      const s = getSession();
      if(!area) return;

      if(!s){
        area.innerHTML = `
          <button id="goLogin" type="button"
            style="background:#0074e9;color:#fff;border:none;border-radius:6px;padding:10px 18px;font-weight:700;cursor:pointer">
            로그인
          </button>
          <a href="signup.html" style="margin-left:8px;color:#9ec2ff;text-decoration:none;font-weight:700">회원가입</a>
        `;
        document.getElementById('goLogin')?.addEventListener('click', () => {
          sessionStorage.setItem('returnTo', location.href);
          location.href = 'login.html';
        });
      } else {
        const users = loadUsers();
        const me = users.find(u => u.username === s.id || u.email === s.id);
        const display = me ? me.username : s.id;
        area.innerHTML = `
          <span style="margin-right:10px">👋 <b>${display}</b> 님</span>
          <button id="logoutBtn" type="button"
            style="background:#444;color:#fff;border:none;border-radius:6px;padding:10px 12px;font-weight:700;cursor:pointer">
            로그아웃
          </button>
        `;
        document.getElementById('logoutBtn')?.addEventListener('click', () => {
          localStorage.removeItem(SESSION_KEY);
          showToast('로그아웃 되었습니다');
          renderLoginArea();
          location.href = 'index.html#전체';
        });
      }
    }

    // 표시/숨김
    function toggleEye(btn){
      const target=document.querySelector(btn.dataset.target);
      if(!target) return;
      target.type = target.type==='password' ? 'text' : 'password';
      btn.textContent = target.type==='password' ? '표시' : '숨김';
    }
    document.querySelectorAll('.toggle').forEach(b=>b.addEventListener('click',()=>toggleEye(b)));

    // 비밀번호 강도
    const enc=new TextEncoder();
    const toHex=b=>Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join('');
    async function hashPw(pw,saltHex){
      const salt=saltHex?Uint8Array.from(saltHex.match(/.{1,2}/g).map(h=>parseInt(h,16))):crypto.getRandomValues(new Uint8Array(16));
      const combined=new Uint8Array(salt.length+enc.encode(pw).length);
      combined.set(salt,0); combined.set(enc.encode(pw),salt.length);
      const digest=await crypto.subtle.digest('SHA-256',combined);
      return { saltHex: toHex(salt), hashHex: toHex(digest) };
    }
    function scorePassword(p){let s=0;const tests=[/.{8,}/,/[a-z]/,/[A-Z]/,/\d/,/[^A-Za-z0-9\s]/];tests.forEach(re=>{if(re.test(p))s++});if(p.length>=12)s++;return Math.min(s,6)}
    function updatePwMeter(){
      const p=$('#suPw').value, s=scorePassword(p);
      const pct=[0,20,40,60,75,90,100][s]; $('#pwBar').style.width=pct+'%';
      const labels=['없음','매우 약함','약함','보통','좋음','강함','아주 강함']; $('#pwLabel').textContent=labels[s]||'약함';
      const req=[]; if(p.length<8)req.push('8자 이상'); if(!/[a-z]/.test(p))req.push('소문자'); if(!/[A-Z]/.test(p))req.push('대문자'); if(!/\d/.test(p))req.push('숫자'); if(!/[^A-Za-z0-9\s]/.test(p))req.push('특수문자');
      $('#pwTips').textContent=req.length?req.join(', '):'좋아요!';
    }
    $('#suPw').addEventListener('input',updatePwMeter);

    // 제출
    $('#signupForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const username=$('#suId').value.trim();
      const email=$('#suEmail').value.trim();
      const pw=$('#suPw').value;
      const pw2=$('#suPw2').value;
      const agree=$('#agree').checked;

      if(!agree){showToast('약관에 동의해야 가입할 수 있어요');return}
      if(pw!==pw2){showToast('비밀번호가 일치하지 않습니다');return}
      if(!/^[a-zA-Z0-9_]{3,20}$/.test(username)){showToast('아이디 형식이 올바르지 않습니다');return}

      const users=loadUsers();
      const dup=users.some(u=>u.username.toLowerCase()===username.toLowerCase() || u.email.toLowerCase()===email.toLowerCase());
      if(dup){showToast('이미 존재하는 아이디/이메일');return}

      const {saltHex,hashHex}=await hashPw(pw);
      users.push({username,email,saltHex,hashHex,createdAt:new Date().toISOString()});
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
      showToast('회원가입 완료! 로그인 페이지로 이동합니다');
      setTimeout(()=>{ location.href='login.html'; }, 600);
    });

    // 로고 → 항상 홈(전체)
    const logoHome=document.getElementById('logoHome');
    logoHome.addEventListener('click',()=>{location.href='index.html#전체'});
    logoHome.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();location.href='index.html#전체';}});

    // 초기 렌더
    renderLoginArea();
  </script>
</body>
</html>
